<script>
			function verifyAgree()
			{
				if (currentAuthMethod == \'passwd\' && document.forms.registration.smf_autov_pwmain.value != document.forms.registration.smf_autov_pwverify.value)
				{
					alert("{{txt.register_passwords_differ_js}}");
					return false;
				}

				return true;
			}

			var currentAuthMethod = \'passwd\';
		</script>
		{{#if context.registration_errors}}
		<div class="errorbox">
			<span>{{txt.registration_errors_occurred}}</span>
			<ul>
			    {{#each context.registration_errors}}
			    <li>{{.}}</li>
			    {{/each}}
			</ul>
		</div>
		{{/if}}
		<form action="', !empty($modSettings['force_ssl']) && $modSettings['force_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl, '?action=signup2" method="post" accept-charset="UTF-8" name="registration" id="registration" onsubmit="return verifyAgree();">
			<div class="cat_bar">
				<h3 class="catbg">{{txt.registration_form}}</h3>
			</div>
			<div class="title_bar title_top">
				<h3 class="titlebg">{{txt.required_info}}</h3>
			</div>
			<div class="roundframe noup">
				<fieldset>
					<dl class="register_form">
						<dt><strong><label for="smf_autov_username">{{txt.username}}:</label></strong></dt>
						<dd>
							<input type="text" name="user" id="smf_autov_username" size="30" maxlength="25" value="{{context.username}}" class="input_text">
							<span id="smf_autov_username_div" style="display: none;">
								<a id="smf_autov_username_link" href="#">
									<span id="smf_autov_username_img" class="generic_icons check"></span>
								</a>
							</span>
						</dd>
						<dt><strong><label for="smf_autov_reserve1">{{txt.user_email_address}}:</label></strong></dt>
						<dd>
							<input type="text" name="email" id="smf_autov_reserve1" size="30" value="{{context.email}}" class="input_text">
						</dd>
					</dl>
					<dl class="register_form" id="password1_group">
						<dt><strong><label for="smf_autov_pwmain">{{txt.choose_pass}}:</label></strong></dt>
						<dd>
							<input type="password" name="passwrd1" id="smf_autov_pwmain" size="30" class="input_password">
							<span id="smf_autov_pwmain_div" style="display: none;">
								<span id="smf_autov_pwmain_img" class="generic_icons invalid"></span>
							</span>
						</dd>
					</dl>
					<dl class="register_form" id="password2_group">
						<dt><strong><label for="smf_autov_pwverify">{{txt.verify_pass}}:</label></strong></dt>
						<dd>
							<input type="password" name="passwrd2" id="smf_autov_pwverify" size="30" class="input_password">
							<span id="smf_autov_pwverify_div" style="display: none;">
								<span id="smf_autov_pwverify_img" class="generic_icons valid"></span>
							</span>
						</dd>
					</dl>
					<dl class="register_form" id="notify_announcements">
						<dt><strong><label for="notify_announcements">{{txt.notify_announcements}}:</label></strong></dt>
						<dd>
							<input type="checkbox" name="notify_announcements" id="notify_announcements" {{#if context.notify_announcements}}checked="checked"{{/if}} class="input_check" />
						</dd>
					</dl>
					{{#if context.custom_fields_required}}
					   {{#if context.custom_fields}}
					   <dl class="register_form">
					   {{#each context.custom_fields}}
					   <dt>
							<strong{{#if is_error}} class="red"{{/if}}>{{name}}:</strong>
							<span class="smalltext">{{desc}}</span>
						</dt>
						<dd>{{input_html}}</dd>
						{{/each}}
						</dl>
						{{/if}}
					{{/if}}
				</fieldset>
			</div>
			
			{{#if (or context.profile_fields context.custom_fields)}}
			<div class="title_bar title_top">
				<h3 class="titlebg">{{txt.additional_information}}</h3>
			</div>
			<div class="roundframe noup">
				<fieldset>
					<dl class="register_form" id="custom_group">
			{{/if}}
			{{#each context.profile_fields}}
				{{#if (eq type "callback")}}{{profile_callback_helper .}}{{else}}
						<dt>
							<strong{{#if is_error}} class="red"{{/if}}>{{label}}</strong>
							{{#if subtext}}<span class="smalltext">{{subtext}}</span>{{/if}}
						</dt>
						<dd>
							{{preinput}}
							{{#if (eq type "label")}}{{value}}{{/if}}
							{{#if field_isText(type)}}<input type="{{#if (eq type "password")}}password{{else}}text{{/if}}" name="{{.}}" id="{{.}}" size="{{#if size}}{{size}}{{else}}30{{/if}}" value="{{value}}" {{input_attr}} class="input_type{{#if (eq type "password")}}password{{else}}text{{/if}}">{{/if}}
							{{#if (eq type "check")}}<input type="hidden" name="{{.}}" value="0"><input type="checkbox" name="{{.}}" id="{{.}}"{{#if value}} checked{{/if}} value="1" class="input_check" {{input_attr}}>{{/if}}
							{{#if (eq type "select")}}
								<select name="{{.}}" id="{{.}}">
									{{#each options}}
										<option value="{{value}}"{{#if value}} selected{{/if}}>{{.}}</option>
									{{/each}}
								</select>
							{{/if}}
							{{postinput}}
						</dd>
				{{/if}}
			{{/each}}
		    {{#each context.custom_fields}}
		                <dt>
							<strong{{#if is_error}} class="red"{{/if}}>{{name}}</strong>
							<span class="smalltext">{{desc}}</span>
						</dt>
						<dd>{{{input_html}}}</dd>
		    {{/each}}
		    {{#if (or context.profile_fields context.custom_fields)}}
					</dl>
				</fieldset>
			</div>
			{{/if}}
			{{#if context.visual_verification}}
			<div class="title_bar title_top">
				<h3 class="titlebg">{{txt.verification}}</h3>
			</div>
			<div class="roundframe noup">
				<fieldset class="centertext">
				{{template_control_verification context.visual_verification_id "all"}}
				{{>visual_verification_control verification_visual}}
				</fieldset>
			</div>
			{{/if}}
			<div id="confirm_buttons" class="flow_auto">
				{{#if (and context.require_agreement context.show_coppa)}}
				<input type="submit" name="accept_agreement" value="{{context.coppa_agree_above}}" class="button_submit"><br><br>
				<input type="submit" name="accept_agreement_coppa" value="{{context.coppa_agree_below}}" class="button_submit">
				{{else}}
				<input type="submit" name="regSubmit" value="{{txt.register}}" tabindex="{{getTabindex}}" class="button_submit">
				{{/if}}
				</div>
			<input type="hidden" name="{{context.session_var}}" value="{{context.session_id}}">
			<input type="hidden" name="{{context.register_token_var}}" value="{{context.register_token}}">
			<input type="hidden" name="step" value="2">
		</form>
		<script>
			var regTextStrings = {
				"username_valid": "{{txt.registration_username_available}}",
				"username_invalid": "{{txt.registration_username_unavailable}}",
				"username_check": "{{txt.registration_username_check}}",
				"password_short": "{{txt.registration_password_short}}",
				"password_reserved": "{{txt.registration_password_reserved}}",
				"password_numbercase": "{{txt.registration_password_numbercase}}",
				"password_no_match": "{{txt.registration_password_no_match}}",
				"password_valid": "{{txt.registration_password_valid}}"
			};
			var verificationHandle = new smfRegister("registration", '{{#if modSettings.password_strength}}{{modSettings.password_strength}}{{else}}0{{/if}}', regTextStrings);
		</script>